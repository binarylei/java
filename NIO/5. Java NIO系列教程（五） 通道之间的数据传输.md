# Java NIO系列教程（五） 通道之间的数据传输

在Java NIO中，如果两个通道中有一个是FileChannel，那你可以直接将数据从一个channel（译者注：channel中文常译作通道）传输到另外一个channel。

### 通道的基本操作

看下面一个小 [demo]()

```java
FileInputStream fis = new FileInputStream("1.png");
FileOutputStream fos = new FileOutputStream("2.png");

//1. 获取通道
FileChannel inChannel = fis.getChannel();
FileChannel outChannel = fos.getChannel();

//2. 分配缓冲区
ByteBuffer buf = ByteBuffer.allocate(1024);

//3. 用通道传输数据
while (inChannel.read(buf) != -1) {
    buf.flip();
    outChannel.write(buf);
    buf.clear();
}
```

### 直接缓冲区拷贝文件

```java
FileChannel inChannel = FileChannel.open(Paths.get("1.png"), StandardOpenOption.READ);
FileChannel outChannel = FileChannel.open(Paths.get("3.png"), StandardOpenOption.WRITE, StandardOpenOption.READ, StandardOpenOption.CREATE);

//内存映射文件，直接缓冲区
MappedByteBuffer inMappedBuf = inChannel.map(FileChannel.MapMode.READ_ONLY, 0, inChannel.size());
MappedByteBuffer outMappedBuf = outChannel.map(FileChannel.MapMode.READ_WRITE, 0, inChannel.size());

byte[] bytes = new byte[inMappedBuf.limit()];
inMappedBuf.get(bytes);
outMappedBuf.put(bytes);
```

### transferFrom()和transferTo()

FileChannel的transferFrom()方法可以将数据从源通道传输到FileChannel中（译者注：这个方法在JDK文档中的解释为将字节从给定的可读取字节通道传输到此通道的文件中）。下面是一个简单的例子：

```java
RandomAccessFile inFile = new RandomAccessFile("fromFile.txt", "rw");
FileChannel inChannel = fromFile.getChannel();

RandomAccessFile outFile = new RandomAccessFile("toFile.txt", "rw");
FileChannel outChannel = toFile.getChannel();

long position = 0;
long count = inChannel.size();

outChannel.transferFrom(position, count, inChannel);
//inChannel.transferTo(position, count, outChannel);
```

方法的输入参数position表示从position处开始向目标文件写入数据，count表示最多传输的字节数。如果源通道的剩余空间小于 count 个字节，则所传输的字节数要小于请求的字节数。
此外要注意，在SoketChannel的实现中，SocketChannel只会传输此刻准备好的数据（可能不足count字节）。因此，SocketChannel可能不会将请求的所有数据(count个字节)全部传输到FileChannel中。


转载自[并发编程网 – ifeve.com](http://ifeve.com/)，本文链接地址: [Java NIO系列教程（二） Channel](http://ifeve.com/java-nio-channel-to-channel/)